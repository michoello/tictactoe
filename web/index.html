<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tic Tac Toe 6x6</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<style>
  body { font-family: sans-serif; text-align: center; margin: 10px; }
  table { border-collapse: collapse; margin: auto; width: 90vw; max-width: 600px; table-layout: fixed; background-color: #ccc; }
  td { border: 1px solid #333; width: 16.66%; position: relative; cursor: pointer; background-color: #eee; }
  td::before { content: ""; display: block; padding-top: 100%; } /* square cells */
  td span { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; justify-content: center; align-items: center; font-size: 6vw; }
  td span.X { color: blue; }
  td span.O { color: green; }
  td span.V { color: red; }
</style>
</head>
<body>
<h2>Tic Tac Toe (6x6)</h2>
<table id="board"></table>

<script>
let current = "X";
// 0 = empty, 1 = X, -1 = O
let boardState = Array.from({length: 6}, () => Array(6).fill(0));

function setCell(r, c, figure, cellClass=figure) {
  const cell = $("#board")
    .find("td")
    .filter(function () {
      return $(this).data("row") === r && $(this).data("col") === c;
    });

  const span = $("<span></span>").text(figure).addClass(cellClass);
  cell.append(span);
  boardState[r][c] = figure === "X" ? 1 : -1;
}

function createBoard() {
  const table = $("#board");
  table.empty();
  table.data("done", false);

  for (let r = 0; r < 6; r++) {
    const row = $("<tr></tr>");
    for (let c = 0; c < 6; c++) {
      const cell = $("<td></td>").data("row", r).data("col", c);

      cell.on("click", function() {
        if (!cell.children().length) {

		  if (table.data("done")) {
		     console.log("Game is over.");
		     return;
		  }

          setCell(r, c, current);

          const startTime = performance.now();
          $.ajax({
            url: "/click",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
              row: r,
              col: c,
              figure: current,
              board: boardState
            }),
            success: function(resp) {
              const endTime = performance.now();
              console.log("Server response:", resp, "Time:", (endTime - startTime).toFixed(2), "ms");

			  if ("row" in resp) {
                setCell(resp.row, resp.col, "O");
			  }
			  if ("winner" in resp) {
				table.data("done", true);
				console.log("Victory: ", resp.winner);
                for (let [x, y] of resp.xyo) {
                   figure = resp.winner === 1 ? "X" : "O";
                   setCell(x, y, figure, "V");
                }
			  }
            },
            error: function(err) {
              console.error("AJAX error:", err);
            }
          });

          //current = current === "X" ? "O" : "X";
          current = "X";
        }
      });
      row.append(cell);
    }
    table.append(row);
  }
}


createBoard();
</script>
</body>
</html>

